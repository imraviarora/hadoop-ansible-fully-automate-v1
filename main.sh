#!/bin/bash

#Set variables
HOSTNAME=`uname -n | awk -F. '{print $1}'`
NODE_PVT_IP=$(/sbin/ip -o -4 addr list eth0 | awk '{print $4}' | cut -d/ -f1)

echo -e "\n---------------------------------------------------------------------------------------------------------------------------\n"
echo -e "INSTALLING\tREQUIRED\tPACKAGES"
echo -e "\n---------------------------------------------------------------------------------------------------------------------------\n"
ansible-playbook -i hosts/host install_required_package.yml
echo -e "\n---------------------------------------------------------------------------------------------------------------------------\n"
echo -e "RUNNING\tJAVA-HADOOP\tINSTALLATION\tPLAYBOOK"
echo -e "\n---------------------------------------------------------------------------------------------------------------------------\n"
ansible-playbook -i hosts/host master.yml
echo -e "\n---------------------------------------------------------------------------------------------------------------------------\n"
echo -e "REPLACING\tWORKER\tIP\tIN\tSLAVES"
echo -e "\n---------------------------------------------------------------------------------------------------------------------------\n"
ansible-playbook -i hosts/host replace-worker-ip.yml
echo -e "\n---------------------------------------------------------------------------------------------------------------------------\n"
echo -e "CONFIGURING\tHADOOP"
echo -e "\n---------------------------------------------------------------------------------------------------------------------------\n"
ansible-playbook -i hosts/host master.yml
echo -e "\n---------------------------------------------------------------------------------------------------------------------------\n"
echo -e "JOINING\tWORKER\tNODES"
echo -e "\n---------------------------------------------------------------------------------------------------------------------------\n"
ansible-playbook -i hosts/host workers.yml -e "master_ip=${NODE_PVT_IP} master_hostname=${HOSTNAME}"
